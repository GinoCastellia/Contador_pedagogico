<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contador Pedagógico Estilo LEGO Fortnite</title>
    <!-- Google Fonts: Lilita One -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&display=swap" rel="stylesheet">
    <!-- Tailwind CSS (se recomienda en el head) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Lilita One', cursive;
            background: linear-gradient(160deg, #3a0ca3 0%, #7209b7 40%, #f72585 100%);
        }
        .timer-container {
            background-color: rgba(10, 20, 40, 0.8);
            backdrop-filter: blur(8px);
            border: 4px solid #facc15; /* Fortnite Gold */
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(250, 204, 21, 0.5); /* Fortnite Gold Shadow */
        }
        .time-display {
            color: #fff;
            text-shadow: 0 0 15px #fff, 0 0 25px #facc15; /* Fortnite Gold Glow */
        }
        .lego-input {
            background-color: #1e293b;
            border: 2px solid #3a0ca3;
            border-radius: 8px;
            color: #fff;
            text-align: center;
        }
        .fortnite-lego-button {
            border-radius: 8px;
            border: 2px solid rgba(0,0,0,0.5);
            border-bottom: 6px solid rgba(0,0,0,0.5);
            color: white;
            text-shadow: 2px 2px #00000060;
            transition: all 0.1s ease-in-out;
            position: relative;
        }
        .fortnite-lego-button:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }
        .btn-deploy { background-color: #facc15; } /* Fortnite Gold */
        .btn-reset { background-color: #7209b7; } /* Fortnite Purple */
        
        .progress-bar-container {
            background-color: #1e293b;
            border-radius: 10px;
            border: 2px solid #3a0ca3;
            padding: 3px;
        }
        .progress-bar { /* Shield Bar Style */
            background: linear-gradient(90deg, #00c6ff, #0072ff);
            border-radius: 6px;
            height: 100%;
            transition: width 0.35s linear;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 text-white">

    <div class="text-center p-6 sm:p-8 rounded-lg timer-container w-full max-w-lg">
        
        <!-- Área de Mensajes Pedagógicos -->
        <div class="w-full text-center mb-4 h-32 flex items-center justify-center">
             <div id="pedagogical-message" class="text-2xl text-cyan-300 p-4 transition-all duration-500 ease-in-out opacity-0 transform scale-90"></div>
        </div>

        <div id="time-display" class="time-display text-6xl sm:text-7xl mb-4">1:00</div>
        
        <div class="progress-bar-container w-full mb-4 h-6">
            <div id="progress-bar" class="progress-bar" style="width: 100%;"></div>
        </div>

        <div id="input-container" class="mb-4 flex justify-center items-center gap-3">
            <input type="number" id="minutes-input" class="lego-input w-24 p-3 text-2xl" placeholder="Min" min="0" max="99" value="1">
            <span class="text-4xl font-black text-gray-400">:</span>
            <input type="number" id="seconds-input" class="lego-input w-24 p-3 text-2xl" placeholder="Seg" min="0" max="59" value="0">
        </div>

        <div class="flex justify-center items-center space-x-4">
            <button id="start-pause-btn" class="fortnite-lego-button btn-deploy py-3 px-6 text-xl"></button>
            <button id="reset-btn" class="fortnite-lego-button btn-reset py-3 px-6 text-xl">Reiniciar</button>
        </div>
        
        <div id="message-area" class="mt-4 text-red-400 h-4 text-sm"></div>
    </div>

    <!-- Tone.js para sonidos (cargado antes del script principal para que esté disponible) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>

    <script>
        // --- SELECCIÓN DE ELEMENTOS DEL DOM ---
        const timeDisplay = document.getElementById('time-display');
        const startPauseBtn = document.getElementById('start-pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const progressBar = document.getElementById('progress-bar');
        const minutesInput = document.getElementById('minutes-input');
        const secondsInput = document.getElementById('seconds-input');
        const messageArea = document.getElementById('message-area');
        const pedagogicalMessage = document.getElementById('pedagogical-message');

        // --- MENSAJES Y TEXTOS ---
        const pedagogicalMessages = [
            "¡Es hora de concentrarse! Revisa tus objetivos.",
            "Lee las instrucciones con atención. ¡Cada detalle cuenta!",
            "Colabora con tu compañero. ¡Dos mentes piensan mejor!",
            "Revisa tu trabajo. ¿Puedes mejorarlo?",
            "¡La creatividad es tu superpoder! Úsala.",
            "¡Silencio y enfoque! Estás creando algo increíble."
        ];
        const playText = `¡Empezar!`;
        const pauseText = `Pausa`;
        const continueText = `Seguir`;
        
        // --- VARIABLES DE ESTADO ---
        let timerInterval, isRunning = false, initialTime = 60, timeLeft = 60;
        let messageMilestones = {};

        // --- FUNCIONES PRINCIPALES ---

        /**
         * Formatea segundos a un string MM:SS.
         * @param {number} s - Segundos totales.
         * @returns {string} Tiempo formateado.
         */
        function formatTime(s) { return `${Math.floor(s/60)}:${(s%60)<10?'0':''}${s%60}` }

        /**
         * Actualiza la barra de progreso.
         * @param {number} p - Porcentaje (0-100).
         */
        function setProgress(p) { progressBar.style.width = `${p}%` }
        
        /**
         * Reproduce sonidos para eventos clave.
         * @param {string} type - 'end' para el final.
         */
        function playSound(type) {
            // Inicia el contexto de audio si el navegador lo requiere
            if (Tone.context.state !== 'running') Tone.start();
            if (type === 'end') {
                const synth = new Tone.PolySynth().toDestination();
                const now = Tone.now();
                synth.triggerAttackRelease(["C5", "E5", "G5"], "8n", now);
                synth.triggerAttackRelease(["G5", "B5", "D6"], "8n", now + 0.2);
            }
        }

        /**
         * Muestra un mensaje pedagógico con una animación de aparición.
         * @param {string} message - El mensaje a mostrar.
         */
        function showPedagogicalMessage(message) {
            pedagogicalMessage.classList.remove('opacity-100', 'scale-100');
            pedagogicalMessage.classList.add('opacity-0', 'scale-90');
            
            setTimeout(() => {
                pedagogicalMessage.textContent = message;
                pedagogicalMessage.classList.remove('opacity-0', 'scale-90');
                pedagogicalMessage.classList.add('opacity-100', 'scale-100');
            }, 300);
        }

        /**
         * Habilita o deshabilita los inputs de tiempo.
         * @param {boolean} enabled - True para habilitar, false para deshabilitar.
         */
        function toggleInputs(enabled) {
            minutesInput.disabled = !enabled; 
            secondsInput.disabled = !enabled;
            minutesInput.classList.toggle('opacity-50', !enabled);
            secondsInput.classList.toggle('opacity-50', !enabled);
        }

        /**
         * Inicia, pausa o reanuda el temporizador.
         */
        function startPauseTimer() {
            if (isRunning) {
                clearInterval(timerInterval);
                isRunning = false;
                startPauseBtn.textContent = continueText;
            } else {
                // Si el contador no está en pausa, lo inicia desde cero
                if (!timerInterval) {
                    initialTime = (parseInt(minutesInput.value) || 0) * 60 + (parseInt(secondsInput.value) || 0);
                    if (initialTime <= 0) {
                        messageArea.textContent = "¡Debes elegir un tiempo!";
                        setTimeout(() => messageArea.textContent = "", 3000);
                        return;
                    }
                    timeLeft = initialTime;
                    
                    // Reinicia los hitos de mensajes y muestra el primero
                    messageMilestones = { m75: false, m50: false, m25: false };
                    showPedagogicalMessage(pedagogicalMessages[0]);
                }
                
                isRunning = true; 
                startPauseBtn.textContent = pauseText;
                toggleInputs(false);
                
                timerInterval = setInterval(() => {
                    timeLeft--;
                    const percentLeft = (timeLeft / initialTime) * 100;
                    setProgress(percentLeft);
                    timeDisplay.textContent = formatTime(timeLeft);

                    // Revisa los hitos de tiempo para mostrar mensajes
                    if (percentLeft < 75 && !messageMilestones.m75) {
                        showPedagogicalMessage(pedagogicalMessages[1]);
                        messageMilestones.m75 = true;
                    } else if (percentLeft < 50 && !messageMilestones.m50) {
                        showPedagogicalMessage(pedagogicalMessages[2]);
                        messageMilestones.m50 = true;
                    } else if (percentLeft < 25 && !messageMilestones.m25) {
                        showPedagogicalMessage(pedagogicalMessages[3]);
                        messageMilestones.m25 = true;
                    }

                    // Cuando el tiempo llega a cero
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        timerInterval = null; 
                        isRunning = false;
                        timeDisplay.innerHTML = `¡Logrado!`;
                        showPedagogicalMessage('¡Excelente trabajo!');
                        startPauseBtn.textContent = playText;
                        toggleInputs(true); 
                        playSound('end'); 
                        setProgress(0);
                    }
                }, 1000);
            }
        }
        
        /**
         * Reinicia el temporizador a su estado inicial.
         */
        function resetTimer() {
            clearInterval(timerInterval);
            timerInterval = null; 
            isRunning = false;
            timeLeft = (parseInt(minutesInput.value) || 0) * 60 + (parseInt(secondsInput.value) || 0);
            timeDisplay.textContent = formatTime(timeLeft);
            startPauseBtn.textContent = playText;
            setProgress(100);
            toggleInputs(true);
            messageArea.textContent = ""; 
            pedagogicalMessage.textContent = "";
            pedagogicalMessage.classList.remove('opacity-100', 'scale-100');
            pedagogicalMessage.classList.add('opacity-0', 'scale-90');
        }
        
        /**
         * Actualiza el display del tiempo cuando se cambia el valor en los inputs.
         */
        function updateDisplayFromInputs() {
            if (isRunning) return;
            const totalSeconds = (parseInt(minutesInput.value) || 0) * 60 + (parseInt(secondsInput.value) || 0);
            timeDisplay.textContent = formatTime(totalSeconds);
            setProgress(100);
        }
        
        // --- ASIGNACIÓN DE EVENTOS ---
        startPauseBtn.addEventListener('click', startPauseTimer);
        resetBtn.addEventListener('click', resetTimer);
        minutesInput.addEventListener('input', updateDisplayFromInputs);
        secondsInput.addEventListener('input', updateDisplayFromInputs);
        
        // --- INICIALIZACIÓN ---
        // Llama a resetTimer() para establecer el estado inicial al cargar la página.
        resetTimer();
    </script>
</body>
</html>
