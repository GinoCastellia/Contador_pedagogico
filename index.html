<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contador Pedagógico con Música de Foco</title>
    <!-- Google Fonts: Lilita One -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lilita+One&display=swap" rel="stylesheet">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Lilita One', cursive;
            background: linear-gradient(160deg, #3a0ca3 0%, #7209b7 40%, #f72585 100%);
        }
        .timer-container {
            background-color: rgba(10, 20, 40, 0.8);
            backdrop-filter: blur(8px);
            border: 4px solid #facc15; /* Fortnite Gold */
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(250, 204, 21, 0.5); /* Fortnite Gold Shadow */
        }
        .time-display {
            color: #fff;
            text-shadow: 0 0 15px #fff, 0 0 25px #facc15; /* Fortnite Gold Glow */
        }
        .lego-input {
            background-color: #1e293b;
            border: 2px solid #3a0ca3;
            border-radius: 8px;
            color: #fff;
            text-align: center;
        }
        .fortnite-lego-button {
            border-radius: 8px;
            border: 2px solid rgba(0,0,0,0.5);
            border-bottom: 6px solid rgba(0,0,0,0.5);
            color: white;
            text-shadow: 2px 2px #00000060;
            transition: all 0.1s ease-in-out;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .fortnite-lego-button:active {
            transform: translateY(4px);
            border-bottom-width: 2px;
        }
        .btn-deploy { background-color: #facc15; } /* Fortnite Gold */
        .btn-reset { background-color: #7209b7; } /* Fortnite Purple */
        .btn-music { background-color: #00c6ff; } /* Blue */
        
        .progress-bar-container {
            background-color: #1e293b;
            border-radius: 10px;
            border: 2px solid #3a0ca3;
            padding: 3px;
        }
        .progress-bar { /* Shield Bar Style */
            background: linear-gradient(90deg, #00c6ff, #0072ff);
            border-radius: 6px;
            height: 100%;
            transition: width 0.35s linear;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 text-white">

    <div class="text-center p-6 sm:p-8 rounded-lg timer-container w-full max-w-lg">
        
        <div class="w-full text-center mb-4 h-32 flex items-center justify-center">
             <div id="pedagogical-message" class="text-2xl text-cyan-300 p-4 transition-all duration-500 ease-in-out opacity-0 transform scale-90"></div>
        </div>

        <div id="time-display" class="time-display text-6xl sm:text-7xl mb-4">1:00</div>
        
        <div class="progress-bar-container w-full mb-4 h-6">
            <div id="progress-bar" class="progress-bar" style="width: 100%;"></div>
        </div>

        <div id="input-container" class="mb-4 flex justify-center items-center gap-3">
            <input type="number" id="minutes-input" class="lego-input w-24 p-3 text-2xl" placeholder="Min" min="0" max="99" value="1">
            <span class="text-4xl font-black text-gray-400">:</span>
            <input type="number" id="seconds-input" class="lego-input w-24 p-3 text-2xl" placeholder="Seg" min="0" max="59" value="0">
        </div>

        <div class="flex justify-center items-center space-x-4">
            <button id="start-pause-btn" class="fortnite-lego-button btn-deploy py-3 px-6 text-xl"></button>
            <button id="reset-btn" class="fortnite-lego-button btn-reset py-3 px-6 text-xl">Reiniciar</button>
            <button id="music-btn" class="fortnite-lego-button btn-music p-3 text-xl">
                 <svg id="music-icon-on" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
                 <svg id="music-icon-off" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="1" y1="1" x2="23" y2="23"></line><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
            </button>
        </div>
        
        <div id="message-area" class="mt-4 text-red-400 h-4 text-sm"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>

    <script>
        const timeDisplay = document.getElementById('time-display');
        const startPauseBtn = document.getElementById('start-pause-btn');
        const resetBtn = document.getElementById('reset-btn');
        const musicBtn = document.getElementById('music-btn');
        const musicIconOn = document.getElementById('music-icon-on');
        const musicIconOff = document.getElementById('music-icon-off');
        const progressBar = document.getElementById('progress-bar');
        const minutesInput = document.getElementById('minutes-input');
        const secondsInput = document.getElementById('seconds-input');
        const messageArea = document.getElementById('message-area');
        const pedagogicalMessage = document.getElementById('pedagogical-message');

        const pedagogicalMessages = [ "¡Es hora de concentrarse! Revisa tus objetivos.", "Lee las instrucciones con atención. ¡Cada detalle cuenta!", "Colabora con tu compañero. ¡Dos mentes piensan mejor!", "Revisa tu trabajo. ¿Puedes mejorarlo?", "¡La creatividad es tu superpoder! Úsala.", "¡Silencio y enfoque! Estás creando algo increíble." ];
        const playText = `¡Empezar!`, pauseText = `Pausa`, continueText = `Seguir`;
        
        let timerInterval, isRunning = false, initialTime = 60, timeLeft = 60;
        let messageMilestones = {};
        let isMusicPlaying = false;
        let binauralBeat;

        function setupMusic() {
            const leftOsc = new Tone.Oscillator(100, "sine").toDestination();
            const rightOsc = new Tone.Oscillator(104, "sine").toDestination();
            const pannerLeft = new Tone.Panner(-1).toDestination();
            const pannerRight = new Tone.Panner(1).toDestination();
            leftOsc.connect(pannerLeft);
            rightOsc.connect(pannerRight);
            
            return {
                start: () => { leftOsc.start(); rightOsc.start(); Tone.Destination.volume.rampTo(0, 0.1); },
                stop: () => { leftOsc.stop(); rightOsc.stop(); }
            };
        }

        function toggleMusic() {
            if (Tone.context.state !== 'running') Tone.start();
            
            if (isMusicPlaying) {
                binauralBeat.stop();
                isMusicPlaying = false;
                musicIconOn.classList.add('hidden');
                musicIconOff.classList.remove('hidden');
            } else {
                binauralBeat = setupMusic();
                binauralBeat.start();
                isMusicPlaying = true;
                musicIconOff.classList.add('hidden');
                musicIconOn.classList.remove('hidden');
            }
        }

        function formatTime(s) { return `${Math.floor(s/60)}:${(s%60)<10?'0':''}${s%60}` }
        function setProgress(p) { progressBar.style.width = `${p}%` }
        
        function playSound(type) {
            if (Tone.context.state !== 'running') Tone.start();
            if (type === 'end') {
                const synth = new Tone.PolySynth().toDestination();
                const now = Tone.now();
                synth.triggerAttackRelease(["C5", "E5", "G5"], "8n", now);
                synth.triggerAttackRelease(["G5", "B5", "D6"], "8n", now + 0.2);
            }
        }

        function showPedagogicalMessage(message) {
            pedagogicalMessage.classList.remove('opacity-100', 'scale-100');
            pedagogicalMessage.classList.add('opacity-0', 'scale-90');
            setTimeout(() => {
                pedagogicalMessage.textContent = message;
                pedagogicalMessage.classList.remove('opacity-0', 'scale-90');
                pedagogicalMessage.classList.add('opacity-100', 'scale-100');
            }, 300);
        }

        function toggleInputs(enabled) {
            minutesInput.disabled = !enabled; 
            secondsInput.disabled = !enabled;
            minutesInput.classList.toggle('opacity-50', !enabled);
            secondsInput.classList.toggle('opacity-50', !enabled);
        }

        function startPauseTimer() {
            if (isRunning) {
                clearInterval(timerInterval);
                isRunning = false;
                startPauseBtn.textContent = continueText;
            } else {
                if (!timerInterval) {
                    initialTime = (parseInt(minutesInput.value) || 0) * 60 + (parseInt(secondsInput.value) || 0);
                    if (initialTime <= 0) {
                        messageArea.textContent = "¡Debes elegir un tiempo!";
                        setTimeout(() => messageArea.textContent = "", 3000);
                        return;
                    }
                    timeLeft = initialTime;
                    messageMilestones = { m75: false, m50: false, m25: false };
                    showPedagogicalMessage(pedagogicalMessages[0]);
                }
                isRunning = true; 
                startPauseBtn.textContent = pauseText;
                toggleInputs(false);
                
                timerInterval = setInterval(() => {
                    timeLeft--;
                    const percentLeft = (timeLeft / initialTime) * 100;
                    setProgress(percentLeft);
                    timeDisplay.textContent = formatTime(timeLeft);

                    if (percentLeft < 75 && !messageMilestones.m75) { showPedagogicalMessage(pedagogicalMessages[1]); messageMilestones.m75 = true; }
                    else if (percentLeft < 50 && !messageMilestones.m50) { showPedagogicalMessage(pedagogicalMessages[2]); messageMilestones.m50 = true; }
                    else if (percentLeft < 25 && !messageMilestones.m25) { showPedagogicalMessage(pedagogicalMessages[3]); messageMilestones.m25 = true; }

                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        timerInterval = null; 
                        isRunning = false;
                        timeDisplay.innerHTML = `¡Logrado!`;
                        showPedagogicalMessage('¡Excelente trabajo!');
                        startPauseBtn.textContent = playText;
                        toggleInputs(true); 
                        playSound('end'); 
                        setProgress(0);
                    }
                }, 1000);
            }
        }
        
        function resetTimer() {
            clearInterval(timerInterval);
            timerInterval = null; 
            isRunning = false;
            timeLeft = (parseInt(minutesInput.value) || 0) * 60 + (parseInt(secondsInput.value) || 0);
            timeDisplay.textContent = formatTime(timeLeft);
            startPauseBtn.textContent = playText;
            setProgress(100);
            toggleInputs(true);
            messageArea.textContent = ""; 
            pedagogicalMessage.textContent = "";
            pedagogicalMessage.classList.remove('opacity-100', 'scale-100');
            pedagogicalMessage.classList.add('opacity-0', 'scale-90');
        }
        
        function updateDisplayFromInputs() {
            if (isRunning) return;
            const totalSeconds = (parseInt(minutesInput.value) || 0) * 60 + (parseInt(secondsInput.value) || 0);
            timeDisplay.textContent = formatTime(totalSeconds);
            setProgress(100);
        }
        
        musicBtn.addEventListener('click', toggleMusic);
        startPauseBtn.addEventListener('click', startPauseTimer);
        resetBtn.addEventListener('click', resetTimer);
        minutesInput.addEventListener('input', updateDisplayFromInputs);
        secondsInput.addEventListener('input', updateDisplayFromInputs);
        
        resetTimer();
    </script>
</body>
</html>


